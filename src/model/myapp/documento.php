<?php class Documento extends Dao {    const TABELA = 'inv_documento';      const ID_GRUPO_CONVENCAO = 1;    const ID_GRUPO_REGULAMENTO = 2;    const ID_GRUPO_ATAS = 3;    const ID_GRUPO_BALANCETES = 4;    const ID_GRUPO_ORGANOGRAMA = 5;     var $titulo; var $arquivo; var $data; var $grupo; var $empresa = NULL; var $usuario = NULL;   public function listaHome($grupo){        $sql = "select u.* from ".$this::TABELA." u where idEmpresa = ".EMPRESA." and grupo = ".$grupo;        $sql .= "  order by data desc limit 0, 3";        return $this -> getSQL($sql);    }        public function get_pasta_grupo($id){        switch ($id) {            case $this::ID_GRUPO_CONVENCAO:                return 'convencao';                break;            case $this::ID_GRUPO_REGULAMENTO:                return 'regulamento';                break;            case $this::ID_GRUPO_ATAS:                return 'atas';                break;            case $this::ID_GRUPO_BALANCETES:                return 'balancetes';                break;            case $this::ID_GRUPO_ORGANOGRAMA:                return 'organograma';                break;            default:                                break;        }    }    public function get_titulo_grupo($id){        switch ($id) {            case $this::ID_GRUPO_CONVENCAO:                return 'Convenção';                break;            case $this::ID_GRUPO_REGULAMENTO:                return 'Regulamento';                break;            case $this::ID_GRUPO_ATAS:                return 'Atas';                break;            case $this::ID_GRUPO_BALANCETES:                return 'Balancetes';                break;            case $this::ID_GRUPO_ORGANOGRAMA:                return 'Administração';                break;            default:                                break;        }    }             function recuperaTotal($busca = "",$grupo="1",$user = "") {                $sql = "select count(id) as total from ".$this::TABELA." WHERE idEmpresa = ".EMPRESA." and grupo = ".$grupo;        if($user != "")            $sql .= " and idUsuario = $user";                if ($busca != "")            $sql .= " and (titulo like '$busca%')";                $rs = $this -> DAO_ExecutarQuery($sql);        return $this -> DAO_Result($rs, "total", 0);    }        function listar($primeiro = 0, $quantidade = 9999, $busca = "",$grupo="1",$user = "") {                $sql = "select u.* from ".$this::TABELA." u where idEmpresa = ".EMPRESA." and grupo = ".$grupo;        if($user != "")            $sql .= " and idUsuario = $user";        if ($busca != "")            $sql .= " and (titulo like '$busca%')";        $sql .= "  order by data desc limit $primeiro, $quantidade";        return $this -> getSQL($sql);    }            public function alterar(){                $idPub = $this->md5_decrypt($_POST['id']);        $this->getById($idPub);        $this->titulo = $_POST['descricao'];        $this->data  =$this->setData($_POST['data']);        $this->usuario = new Usuario($_SESSION['zurc.userId']);        $pasta = $this->get_pasta_grupo($this->grupo);        if ($_FILES['documento']['name'] != "") {            $this -> apagaImagem($this -> arquivo, "documentos/".$pasta."/");            //incluir documento            $nomeDoc = $this -> retornaNomeUnico($_FILES['documento']['name'], "documentos/".$pasta."/");            $this -> uploadArquivo($_FILES['documento'], $nomeDoc, "documentos/".$pasta."/");                        $this -> arquivo = $nomeDoc;        }                $this->save();        $_SESSION['zurc.mensagem'] = 28;            }        public function incluir($grupo){        $this->titulo = $_POST['descricao'];        $this->empresa = new Empresa(EMPRESA);        $this->usuario = new Usuario($_SESSION['zurc.userId']);        $this->grupo = $grupo;        $this->data  =$this->setData($_POST['data']);                $pasta = $this->get_pasta_grupo($grupo);                if ($_FILES['documento']['name'] != "") {                        //incluir documento            $nomeDoc = $this -> retornaNomeUnico($_FILES['documento']['name'], "documentos/".$pasta."/");            $this -> uploadArquivo($_FILES['documento'], $nomeDoc, "documentos/".$pasta."/");                        $this -> arquivo = $nomeDoc;        }        $this->save();        $_SESSION['zurc.mensagem'] = 27;        }        public function excluir(){              $idU =  $this->md5_Decrypt($_REQUEST['id']);        $this->getById($idU);        $pasta = $this->get_pasta_grupo($this->grupo);        $this -> apagaImagem($this -> arquivo, "documentos/".$pasta."/");        if($this->delete($idU)){            $_SESSION['zurc.mensagem'] = 29;        }else{            $_SESSION['zurc.mensagem'] = 30;        }       }}